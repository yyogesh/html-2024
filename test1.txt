import { Readability } from '@mozilla/readability';

/**
 * Removes HTML tags from a string.
 * @param {string} html - The HTML string to parse.
 * @returns {string} The text content.
 */
function removeTags(html) {
  const doc = new DOMParser().parseFromString(html, 'text/html');
  return doc.body.textContent || '';
}

/**
 * Processes the current document to extract the main article content and metadata.
 * @param {Document} document - The document object to process.
 * @returns {{content: string, metadata: Object}}
 */
export function processArticle(document) {
  const documentClone = document.cloneNode(true);
  const reader = new Readability(documentClone);
  const article = reader.parse();

  const content = article ? removeTags(article.content) : document.body.innerText;

  const metadata = article
    ? {
        title: article.title,
        byline: article.byline,
        length: article.length,
        excerpt: article.excerpt,
        siteName: article.siteName,
      }
    : {
        title: document.title,
      };

  return { content, metadata };
}
