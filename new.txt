// src/utils/dom.ts

import { SupportedDomain } from '../types';

export function getCurrentDomain(): SupportedDomain | null {
  const hostname = window.location.hostname;
  if (hostname.includes('claude.ai')) return 'claude.ai';
  if (hostname.includes('chatgpt.com')) return 'chatgpt.com';
  return null;
}

/**
 * Injects a root element for the React app to mount onto.
 */
export function injectRootElement(): HTMLElement {
  const existingRoot = document.getElementById('aig-lite-content-script-root');
  if (existingRoot) return existingRoot;

  const root = document.createElement('div');
  root.id = 'aig-lite-content-script-root';
  document.body.appendChild(root);
  return root;
}



// src/utils/contentProcessor.ts
import { Readability } from '@mozilla/readability';
import { ProcessedArticle } from '../types';

function removeTags(html: string): string {
  const doc = new DOMParser().parseFromString(html, 'text/html');
  return doc.body.textContent || '';
}

export function processArticle(document: Document): ProcessedArticle {
  const documentClone = document.cloneNode(true) as Document;
  const reader = new Readability(documentClone);
  const article = reader.parse();

  if (!article) {
    return {
        content: document.body.innerText,
        metadata: { title: document.title }
    }
  }

  return {
    content: removeTags(article.content),
    metadata: {
      title: article.title,
      byline: article.byline,
      length: article.length,
      excerpt: article.excerpt,
      siteName: article.siteName,
    },
  };
}
